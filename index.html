<!DOCTYPE html>
<html>
  <head>
    <title>Mapa con Leaflet</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 1000px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      // Crea el mapa y lo muestra en el elemento con el id "map"
      var map = L.map("map").setView(
        [10.422949325767693, -83.67284801511495],
        10
      );

      const poligonoPococí = [
        [10.145495541989929, -83.94741061888186],
        [10.066657380088952, -83.77142847151973],
        [10.085495333436457, -83.77065651814438],
        [10.096858572634948, -83.76623537028743],
        [10.099893780306271, -83.77217863290895],
        [10.108706844687989, -83.76775829984324],
        [10.124256896613161, -83.76437388650244],
        [10.131298885920902, -83.75597985818129],
        [10.172201829235496, -83.75235257044525],
        [10.18526169627192, -83.74974122233989],
        [10.22838243580832, -83.73008985976395],
        [10.243635246455252, -83.72630067580522],
        [10.269665077127835, -83.6855115217451],
        [10.276469932628883, -83.67942523426261],
        [10.286312976562797, -83.67354329459472],
        [10.290457755556055, -83.6678478078312],
        [10.351951405189917, -83.66587162858826],
        [10.357415813711963, -83.64332467214311],
        [10.357255229253616, -83.6317238065745],
        [10.357201652437732, -83.6315604153267],
        [10.3632558416613, -83.62295488061976],
        [10.364541580841431, -83.61494819901408],
        [10.378469817091307, -83.60122508455366],
        [10.375951754292082, -83.5938726005221],
        [10.357362140929302, -83.58200016921158],
        [10.340325032943403, -83.57432109695992],
        [10.314664910365064, -83.56782859201994],
        [10.299253573644497, -83.56924483787395],
        [10.297012641322425, -83.54887916325265],
        [10.298448141704906, -83.52373069460603],
        [10.302966119327314, -83.51767964052833],
        [10.297067305546095, -83.49415574697645],
        [10.288284577078818, -83.46990855351899],
        [10.288121039914133, -83.46988303785794],
        [10.28397529077866, -83.43821905787942],
        [10.288058710035257, -83.42653715374014],
        [10.284969502860449, -83.41041665632355],
        [10.298411242749886, -83.39860664584603],
        [10.29885087349504, -83.38788185223164],
        [10.28955443752279, -83.36458077280625],
        [10.29181620896287, -83.34370631923413],
        [10.314866715524953, -83.35711201449635],
        [10.318007138558468, -83.35806945243183],
        [10.353866924980872, -83.38934986378908],
        [10.351606206447793, -83.39190362872654],
        [10.353427371535158, -83.39062671618996],
        [10.355436988180111, -83.39043507332673],
        [10.586937507374753, -83.52195167450957],
        [10.58781611014563, -83.5233561741686],
        [10.579908880816722, -83.52093043056912],
        [10.575519395156709, -83.51833984541743],
        [10.572672436576331, -83.51738887755386],
        [10.544251472555235, -83.50382688444249],
        [10.538096715894177, -83.5043988246043],
        [10.532176549658512, -83.50470995304647],
        [10.530954820790143, -83.50494296290842],
        [10.427318866556863, -83.45140836717354],
        [10.424556175270622, -83.45096142264322],
        [10.387259695519168, -83.4248515879936],
        [10.373751311362312, -83.43347550253053],
        [10.381949893321496, -83.45078612708723],
        [10.383698926518534, -83.42787290281171],
        [10.391143145879703, -83.43442806727106],
        [10.384432834836709, -83.42771297487865],
        [10.386949043463687, -83.42606061461635],
        [10.426251676252008, -83.45364080279634],
        [10.427762263702968, -83.45320184148277],
        [10.529928358584952, -83.50707026530688],
        [10.536692565360875, -83.50630621664963],
        [10.592594697814452, -83.52454128219965],
        [10.802552888427591, -83.58868832460729],
        [10.908913793861355, -83.64063500060709],
        [10.933650120352448, -83.6749534761223],
        [10.940762755070029, -83.69793979962107],
        [10.932736038569391, -83.68773565417405],
        [10.907920766711017, -83.6742098817873],
        [10.89769778922001, -83.68302003552839],
        [10.89219246946023, -83.67599045997947],
        [10.89184246516253, -83.67002845132977],
        [10.875594776615522, -83.66787054637354],
        [10.852865151745013, -83.6752748581349],
        [10.83832127436609, -83.66787043205818],
        [10.833490149851091, -83.66885423749146],
        [10.818436555921853, -83.66000057079421],
        [10.798042331987524, -83.67025231822765],
        [10.788937762829715, -83.69261986156779],
        [10.79331222608366, -83.71410811163206],
        [10.785682758818922, -83.72373799101595],
        [10.77342463603912, -83.76091477107808],
        [10.76140762676306, -83.74421023764768],
        [10.746655249235952, -83.73520130962596],
        [10.730856827036959, -83.7403004691586],
        [10.721140109426601, -83.73962759155872],
        [10.70394392701222, -83.71689719080668],
        [10.693056513309527, -83.71047658965799],
        [10.691074435985858, -83.7205054037567],
        [10.692452516737912, -83.72104881436547],
        [10.6936411430887, -83.72627282980055],
        [10.69252142673742, -83.73344252286593],
        [10.69886085297135, -83.75815455831341],
        [10.695249246105861, -83.77225428681426],
        [10.657742381548614, -83.78791895770678],
        [10.64952223425379, -83.81255475940317],
        [10.628048428333871, -83.82384842173474],
        [10.541559336868728, -83.82687693784492],
        [10.499918683747154, -83.81510169638803],
        [10.459094700238593, -83.8192858624616],
        [10.430516594434302, -83.85898531768383],
        [10.398388650906263, -83.86544187507602],
        [10.398949237290122, -83.86563191276014],
        [10.347013606003259, -83.85006079365655],
        [10.329263189425381, -83.85385727240705],
        [10.289276499950638, -83.84986946836085],
        [10.266851700274414, -83.85328742428455],
        [10.249845835027996, -83.86240415304904],
        [10.241994770501304, -83.87379757024364],
        [10.19396011188869, -83.92678719195165],
        [10.1889134285556, -83.93020596517258],
        [10.146292498733354, -83.94748870566995],
      ];

      const marcadores = [
        {
          nombre: "Kimberly",
          coords: [10.3080941, -83.8108609],
        },
        {
          nombre: "Farmacia Maxi Palí Guápiles",
          coords: [10.2035916, -83.7837496],
        },
        {
          nombre: "Farmacia Pococí S.A",
          coords: [10.3610397, -83.7332214],
        },
        {
          nombre: "Farmacia Atlántica",
          coords: [10.2143231, -83.7910724],
        },
        {
          nombre: "Farmacia Fichel Guapiles",
          coords: [10.211459, -83.7889061],
        },
        {
          nombre: "Farmacia Total",
          coords: [10.2787104, -83.7852121],
        },
        {
          nombre: "Macrobiótica La Central",
          coords: [10.2145871, -83.7899768],
        },
        {
          nombre: "Farmacia Clínica Del Caribe",
          coords: [10.21619, -83.7908585],
        },
        {
          nombre: "FARMACIA GENESIS CARIARI",
          coords: [10.488088, -83.6135572],
        },
        {
          nombre: "Farmacia Talamanca #3",
          coords: [10.2099125, -83.6],
        },
      ];

      // Carga y muestra los mosaicos del proveedor de OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
        maxZoom: 18,
      }).addTo(map);

      var polygon = L.polygon(poligonoPococí).addTo(map);
      const listaNombres = [];

      marcadores.forEach((marcador, index) => {
        let coords = marcador.coords;
        let marker = L.marker(coords);
        if (isMarkerInsidePolygon(marker, polygon)){
            marker.addTo(map);
            marker.bindPopup(marcador.nombre).openPopup();
            listaNombres.push(marcador.nombre);
        }
      });

      console.log(listaNombres);

      function isMarkerInsidePolygon(marker, poly) {
        var inside = false;
        var x = marker.getLatLng().lat,
          y = marker.getLatLng().lng;
        for (var ii = 0; ii < poly.getLatLngs().length; ii++) {
          var polyPoints = poly.getLatLngs()[ii];
          for (
            var i = 0, j = polyPoints.length - 1;
            i < polyPoints.length;
            j = i++
          ) {
            var xi = polyPoints[i].lat,
              yi = polyPoints[i].lng;
            var xj = polyPoints[j].lat,
              yj = polyPoints[j].lng;

            var intersect =
              yi > y != yj > y && x < ((xj - xi) * (y - yi)) / (yj - yi) + xi;
            if (intersect) inside = !inside;
          }
        }

        return inside;
      }
      // Agrega un polígono con las coordenadas dadas
    </script>
  </body>
</html>
